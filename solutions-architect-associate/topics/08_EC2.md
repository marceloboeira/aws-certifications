# EC2
> Amazon Elastic Compute Cloud

Web Service that provides resizable compute capacity in the cloud.

## Pricing Models

* On Demand
  * Fixed rate price, no commitment
  * Applications that can't be interrupted
  * Applications with spiky traffic
* Reserved
  * Long-term commitment, cheaper prices (from 1 to 3 years)
  * Applications with steady load and expected requirements
  * Types:
    * Standard
    * Convertible - You can change over time
    * Scheduled - Specific time-window usage
* Spot
  * Enables you to bid whatever price you want for on-demand compute, if your applications have flexible start/end times.
  * Urgent compute needs
  * Applications that can be interrupted
* Dedicated Hosts
  * Physical EC2 (e.g.: for licensing purposes)
  * Regulatory needs

More info: https://aws.amazon.com/ec2/pricing/

## Types of Instances

* F - FPGA
* I - IOPS
* G - Graphics/GPU
* H - High Disk Throughput
* T - Cheap General Purpose (t1.micro)
* D - Density
* R - RAM
* M - Main purpose
* C - Compute/CPU
* P - Graphics
* X - Extreme Memory
* Z - Extreme Memory and CPU
* A - Arm
* U - Bare metal

## Lab

* Setup an instance (with AMS-LINUX-2)
* Allow SG to connect to SSH
* Create a SSH Public/Private Keyset
* Create instance
* Connect to the instance via SSH
* `sudo su`
* `yum update -y`
* Install apache `yum install httpd`
* Create a `/var/www/html/index.html`
* Start server `service httpd start`
* Onboot configs: `chkconfig on`
* Check public IP, e.g.: `http://35.156.91.242/index.html`

### Take-aways

* IOPS - Input/Output per second
* You are able to encrypt root devices
* EBS Backed instance is set to delete on terminate
* Other types are not automatically selected for delete on termination

## Security Groups Lab

* Whitelist based
  * All inboud in blocked by default
  * All outbout is allowed by default
* Instance Group changes take effect immediately
* Security Groups are Stateful
  * When you allow inbound rules, the outbound are set by default
* You can attach multiple security groups to a single EC2 instance

## EBS
> Elastic Block Store

* Persisted Block Store Volumes
* EBS is automatically replicated within the AZ
* Virtual HD
* 5 Types
  * General Purpose SSD (gp2)
    * Balance in Price and Performance
    * Up to 16k IOPS
  * Provisioned IOPS (SSD) (io1)
    * Mission critical, e.g.: Databases
    * Up to 65k IOPS
  * Throughput Optimiseed HDD (Physical Magnetic) (st1)
    * 500 IOPS
    * Big Data, Data Warehouse
  * Cold Hard-Disk Drive (Magnetic) (sc1)
    * 250 IOPS
    * File Servers, Infrequently accessed
  * EBS Magnetic (standard)
    * 40-250 IOPS
    * Data archive?

* Your EBS volume will always be on the same AZs of the EC2 instance

### Moving EBS to another region

* Create a snapshot
* Create an image (from the snapshot)
* Virtualization: HVM vs PM
  * HVM the guest VM uses hardware
  * Depends on the instance type (HVM is more compatible)
* The image becomes an AMI and it can be used to deploy new instances
* Create a new AZs
* You can copy the AMI to other regions in order to launch EC2 in order Regions
* It is better to stop the instance but you can also do it with the instance running

### EBS Lab

* Create a new volume
* Attach volume to instance
* Connect to instance
* Format volume
* Mount
* Test
* More info: https://devopscube.com/mount-ebs-volume-ec2-instance/
